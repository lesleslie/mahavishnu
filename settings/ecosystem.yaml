# Ecosystem configuration for Mahavishnu
# This file defines the repositories that Mahavishnu manages

repos:
  - name: "mahavishnu"
    path: "/Users/les/Projects/mahavishnu"
    tags: ["orchestrator", "main"]
    description: "Multi-agent orchestration system"
    status: "active"

  - name: "crackerjack"
    path: "/Users/les/Projects/crackerjack"
    tags: ["quality", "testing"]
    description: "Quality assurance and testing framework"
    status: "active"

  - name: "session-buddy"
    path: "/Users/les/Projects/session-buddy"
    tags: ["session-management", "memory"]
    description: "Session management and conversation tracking"
    status: "active"

  - name: "oneiric"
    path: "/Users/les/Projects/oneiric"
    tags: ["configuration", "lifecycle"]
    description: "Configuration and lifecycle management"
    status: "active"

  - name: "mcp-common"
    path: "/Users/les/Projects/mcp-common"
    tags: ["library", "shared", "foundation"]
    description: "Foundation library for MCP servers"
    status: "active"

  - name: "mdinject"
    path: "/Users/les/Projects/mdinject"
    tags: ["app", "macos", "swiftui", "gui"]
    description: "macOS SwiftUI desktop app for markdown prompt management (IPC via Unix socket)"
    status: "active"

  - name: "akosha"
    path: "/Users/les/Projects/akosha"
    tags: ["semantic", "search", "vector", "knowledge"]
    description: "Semantic search and knowledge aggregation"
    status: "active"

  - name: "dhruva"
    path: "/Users/les/Projects/dhruva"
    tags: ["workflow", "config", "distribution"]
    description: "Workflow configuration and Oneiric adapter distribution"
    status: "active"

# Coordination: Issues, Plans, and Todos
# Generated by Power Trios review on 2026-02-20

coordination:
  issues:
    # P0 Issues - Critical
    - id: MHV-001
      title: "asyncio.run() called in sync context"
      description: |
        app.py:707 calls asyncio.run() inside _check_user_repo_permission
        which will fail at runtime when called from async code.
        This creates a nested event loop scenario that Python does not support.
      severity: critical
      priority: P0
      status: pending
      pool: python
      affected_files:
        - mahavishnu/core/app.py
      created_at: 2026-02-20T12:00:00Z
      labels:
        - async
        - bug
        - runtime-error

    - id: MHV-002
      title: "Missing logger import in unified_orchestrator.py"
      description: |
        Lines 223-225 reference `logger` but it is never imported.
        Will crash when cancel_workflow hits an exception.
        Need to add: import logging; logger = logging.getLogger(__name__)
      severity: critical
      priority: P0
      status: pending
      pool: python
      affected_files:
        - mahavishnu/core/unified_orchestrator.py
      created_at: 2026-02-20T12:00:00Z
      labels:
        - bug
        - import-error

    - id: MHV-003
      title: "No shutdown events in background loops"
      description: |
        Four background loops lack shutdown events, preventing graceful stops:
        - resilience.py:705 - _circuit_breaker_loop
        - monitoring.py:200 - _metrics_loop
        - memory_aggregator.py:165 - _sync_loop
        - terminal/pool.py:201 - _pool_loop
        Each needs asyncio.Event for clean shutdown.
      severity: critical
      priority: P0
      status: pending
      pool: python
      affected_files:
        - mahavishnu/core/resilience.py
        - mahavishnu/core/monitoring.py
        - mahavishnu/pools/memory_aggregator.py
        - mahavishnu/terminal/pool.py
      created_at: 2026-02-20T12:00:00Z
      labels:
        - async
        - shutdown
        - graceful-stop

    # P1 Issues - Important
    - id: MHV-004
      title: "N+1 HTTP pattern in batch insert"
      description: |
        memory_aggregator.py:118-147 makes sequential HTTP requests for each
        memory item in batch_insert_memories. Should use asyncio.gather()
        for parallel requests or implement a batch endpoint.
      severity: high
      priority: P1
      status: pending
      pool: perf
      affected_files:
        - mahavishnu/pools/memory_aggregator.py
      created_at: 2026-02-20T12:00:00Z
      labels:
        - performance
        - http
        - batch

    - id: MHV-005
      title: "SSRF vulnerability in content ingestion"
      description: |
        content_ingester.py accepts arbitrary URLs without validation.
        No blocklist for:
        - Internal IP ranges (10.x, 172.16-31.x, 192.168.x)
        - Cloud metadata endpoints (169.254.169.254)
        - file:// protocol
        Needs URL validation and allowlist/blocklist.
      severity: high
      priority: P1
      status: pending
      pool: security
      affected_files:
        - mahavishnu/ingesters/content_ingester.py
      created_at: 2026-02-20T12:00:00Z
      labels:
        - security
        - ssrf
        - input-validation

    - id: MHV-006
      title: "Heap synchronization missing in pool manager"
      description: |
        pools/manager.py:185-232 modifies heap and dict without synchronization.
        The _priority_heap and _pool_metrics are accessed concurrently without
        locks, which could cause race conditions under high concurrency.
        Needs threading.Lock or asyncio.Lock protection.
      severity: high
      priority: P1
      status: pending
      pool: python
      affected_files:
        - mahavishnu/pools/manager.py
      created_at: 2026-02-20T12:00:00Z
      labels:
        - concurrency
        - race-condition

    # P2 Issues - Enhancement
    - id: MHV-007
      title: "datetime.utcnow() deprecation"
      description: |
        Python 3.12+ deprecates datetime.utcnow() in favor of datetime.now(UTC).
        Six files use the deprecated pattern:
        - mahavishnu/core/dependency_graph.py
        - mahavishnu/core/task_ordering.py
        - mahavishnu/core/pattern_detection.py
        - mahavishnu/core/predictions.py
        - mahavishnu/models/pattern.py
        Should migrate to: datetime.now(timezone.utc) or datetime.now(UTC)
      severity: medium
      priority: P2
      status: pending
      pool: python
      affected_files:
        - mahavishnu/core/dependency_graph.py
        - mahavishnu/core/task_ordering.py
        - mahavishnu/core/pattern_detection.py
        - mahavishnu/core/predictions.py
        - mahavishnu/models/pattern.py
      created_at: 2026-02-20T12:00:00Z
      labels:
        - deprecation
        - python-3.12

    - id: MHV-008
      title: "Status enum proliferation"
      description: |
        20+ status enums with overlapping values (PENDING, IN_PROGRESS, etc)
        across multiple files. This creates maintenance burden and potential
        for inconsistent state handling.
        Should consolidate to ~4 base enums:
        - TaskStatus
        - WorkflowStatus
        - PoolStatus
        - WorkerStatus
      severity: medium
      priority: P2
      status: pending
      pool: python
      affected_files:
        - mahavishnu/core/task_store.py
        - mahavishnu/core/dependency_graph.py
        - mahavishnu/core/progress_tracker.py
        - mahavishnu/core/coordination/models.py
      created_at: 2026-02-20T12:00:00Z
      labels:
        - refactoring
        - deduplication

  plans:
    - id: PLAN-001
      title: "Phase 1 Critical Fixes"
      description: |
        Fix all P0 issues before any P1/P2 work.
        These are runtime-breaking bugs that need immediate attention.
      issue_ids:
        - MHV-001
        - MHV-002
        - MHV-003
      status: pending
      created_at: 2026-02-20T12:00:00Z

    - id: PLAN-002
      title: "Phase 2 Performance & Security"
      description: |
        Address P1 performance and security issues.
        Depends on Phase 1 completion.
      issue_ids:
        - MHV-004
        - MHV-005
        - MHV-006
      depends_on:
        - PLAN-001
      status: pending
      created_at: 2026-02-20T12:00:00Z

    - id: PLAN-003
      title: "Phase 3 Code Quality"
      description: |
        Address P2 code quality improvements.
        Depends on Phase 2 completion.
      issue_ids:
        - MHV-007
        - MHV-008
      depends_on:
        - PLAN-002
      status: pending
      created_at: 2026-02-20T12:00:00Z

  todos:
    - id: TODO-001
      issue_id: MHV-003
      task: "Add shutdown event to resilience.py background loop (_circuit_breaker_loop at line 705)"
      status: pending
      created_at: 2026-02-20T12:00:00Z

    - id: TODO-002
      issue_id: MHV-003
      task: "Add shutdown event to monitoring.py background loop (_metrics_loop at line 200)"
      status: pending
      created_at: 2026-02-20T12:00:00Z

    - id: TODO-003
      issue_id: MHV-003
      task: "Add shutdown event to memory_aggregator.py background loop (_sync_loop at line 165)"
      status: pending
      created_at: 2026-02-20T12:00:00Z

    - id: TODO-004
      issue_id: MHV-003
      task: "Add shutdown event to terminal/pool.py background loop (_pool_loop at line 201)"
      status: pending
      created_at: 2026-02-20T12:00:00Z
