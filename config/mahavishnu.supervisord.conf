# Mahavishnu MCP Server - Supervisord Configuration
#
# Installation:
#   1. Copy this file to /etc/supervisor/conf.d/mahavishnu.conf
#   2. Run: sudo supervisorctl reread
#   3. Run: sudo supervisorctl update
#   4. Run: sudo supervisorctl start mahavishnu
#
# Usage:
#   sudo supervisorctl start mahavishnu     # Start service
#   sudo supervisorctl stop mahavishnu      # Stop service
#   sudo supervisorctl restart mahavishnu   # Restart service
#   sudo supervisorctl status mahavishnu    # Check status
#   sudo supervisorctl tail -f mahavishnu   # View logs

[program:mahavishnu]
# Command to start Mahavishnu MCP server
command=/opt/mahavishnu/.venv/bin/python -m mahavishnu.cli mcp start
directory=/opt/mahavishnu
user=mahavishnu
autostart=true
autorestart=true

# Auto-restart configuration
# unexpected: exit if exit code is not 0 or 2
# exit codes: 0=ok, 2=don't restart, 1=restart
exitcodes=0
# Restart on failure
startretries=5
stopwaitsecs=10
# Seconds to wait before restarting
stopasgroup=true
killasgroup=true

# Redirect stdout/stderr to files
stdout_logfile=/var/log/mahavishnu/mahavishnu.out.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile=/var/log/mahavishnu/mahavishnu.err.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=10

# Environment variables
environment=
    PYTHONUNBUFFERED="1",
    PATH="/opt/mahavishnu/.venv/bin"

# Process priority (nice -19 to 20, default 0)
priority=999

# Start as daemon (background process)
daemonize=false

# PID file
pidfile=/var/run/mahavishnu/mahavishnu.pid

[group:mahavishnu]
programs=mahavishnu
priority=999
